<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Why is dbt so important? üìä   | Rahul Vishwakarma Blog</title>
    <link rel="stylesheet" type="text/css" href="../styles.css" media="screen" />
</head>
<body>
<header>
    <nav>
        <a href="/index.html" aria-label="Go back to the homepage">‚Üê Back</a>
        <a href="https://highgrowthengineering.substack.com/p/why-is-dbt-so-important-" target="_blank" rel="noopener noreferrer">
            View Original
        </a>
    </nav>
</header>

<main>
    <article>
        <h1>Why is dbt so important? üìä  </h1>
        <section>
            
            <p>&#128075; Hello!</p><p>Oh man, it&#8217;s been so hot in London recently. Houses in the UK are built to live in the middle of the temperature distribution: not too hot, not too cold. Anything outside the realm of -5C to 25C doesn&#8217;t get handled well. Shout out to the people working all day in 35 degree heat without air conditioning.</p><p>If this is your first time here, hello! I&#8217;ve spent the past 7 years working for high growth companies. My path has followed a &#8216;do-what-needs-to-be-done&#8217; path: software engineering, data science, machine learning, with a little product management thrown in for good measure. I&#8217;ve picked up some useful experience at the intersection of these disciplines, and I&#8217;d love to share it with you.</p><p>The goal of this newsletter is to discuss techniques for&nbsp;<strong>building better software&nbsp;</strong>and&nbsp;<strong>being more effective&nbsp;</strong>in&nbsp;<strong>high growth companies</strong>. I mix in longer form content &#8212; think a short blog post that you could read in 5 minutes &#8212; with some of my favourite links. Here&#8217;s some really popular posts from the past few months:</p><ul><li><p><a href="https://highgrowthengineering.substack.com/p/beware-the-mean-">Beware the mean &#128201;</a></p></li><li><p><a href="https://highgrowthengineering.substack.com/p/the-power-of-static-analysis-">The power of static analysis &#129302;</a></p></li><li><p><a href="https://highgrowthengineering.substack.com/p/the-power-of-proposals-">The power of proposals &#9997;&#65039;</a></p></li></ul><p>Stephen</p><p class="button-wrapper" data-attrs="{&quot;url&quot;:&quot;https://twitter.com/sjwhitworth&quot;,&quot;text&quot;:&quot;Follow me on Twitter &#128038;&quot;,&quot;action&quot;:null,&quot;class&quot;:null}" data-component-name="ButtonCreateButton"><a class="button primary" href="https://twitter.com/sjwhitworth"><span>Follow me on Twitter &#128038;</span></a></p><div><hr></div><h1>Why is dbt so important?</h1><p>I joined Monzo in March 2019 to run the Data Engineering team. Last summer, we migrated&nbsp;<a href="https://monzo.com/">Monzo's</a>&nbsp;entire analytics infrastructure to&nbsp;<a href="https://www.getdbt.com/">dbt</a>&nbsp;from a homegrown solution. This post explains why we took a bet on dbt, and why I think it's one of the most important data tools around.</p><h2>Where have we come from?</h2><h3>The 'looseness' of SQL</h3><p>SQL is a very &#8216;loose&#8217; language. It doesn&#8217;t naturally push you towards good software engineering practises around re-use of code, abstraction and layering, and separation of responsibility. There are often many ways to accomplish the same objective.</p><p>Users are left to choose their own adventure with respect to defining how different SQL files relate to each other, and how they run them in the correct order. Many organisations develop their own tools for running SQL, and managing relationships between various files. These tools incur high maintenance costs.</p><p>Additionally, these tools are a great example of &#8216;non-differentiated heavy lifting&#8217;: being great at running SQL generally doesn&#8217;t provide any competitive advantage in the market.</p><h3>Testing is challenging</h3><p>Testing is challenging in SQL. There's no tooling or primitives that make this particularly easy or encouraged. Users often have to build a custom way to test that their models are correct. This doesn&#8217;t create value.</p><h3>Lack of machine readability</h3><p>It's very hard to introspect SQL files for the actual schema they will generate. You can use a SQL parser to drive and derive structure, but this is complex. There are moves in this direction with projects like&nbsp;<a href="https://github.com/google/zetasql">ZetaSQL</a>, but it's still early days.</p><p>Comments are often kept in the code. They are useful, but duplication of what a particular field means is necessary for tools like Looker.</p><h2>So, what is dbt?</h2><p>dbt, <a href="https://blog.getdbt.com/what--exactly--is-dbt-/">as stated by the CEO himself</a>, is &#8216;a tool to help you write and execute the data transformation jobs that run inside your warehouse&#8217;. It&#8217;s made out of two sections:</p><ul><li><p>A compiler: you use a mixture of SQL, and <a href="https://jinja.palletsprojects.com/en/2.11.x/">Jinja</a> to define your transformations in SQL. You can reference other models to build on top of them, instead of referring to tables. dbt then compiles everything down to the SQL that needs to run.</p></li><li><p>A runner: dbt understands the links between each model because of these references, creating a directed acyclic graph or DAG. It then runs your SQL against your data warehouse in the correct order.</p></li></ul><p>Below shows the user experience on the command line. Write some slightly different looking SQL, and type <strong>dbt run</strong>. Simples! We&#8217;ll get into the many other features next.</p><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif" width="1456" height="788" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:788,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:127950,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/gif&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3ff54e45-1f9b-4dda-b8df-69b7d0553c89_2637x1428.gif 1456w" sizes="100vw" loading="lazy"></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><h2>How does it help?</h2><h3>SQL first</h3><p>Data warehouses are a&nbsp;<strong>really</strong>&nbsp;effective way to efficiently transform data. I&#8217;d argue that you don&#8217;t really need to do much transformation before your data gets into a warehouse anymore. Load it in as raw a format as possible, and transform through SQL.</p><p>So, why not use Python, or other languages? SQL is arguably one of the most popular programming languages in the world. Many folks from across many disciplines know enough SQL to be productive. This isn&#8217;t the case with more traditional programming languages. SQL has a low learning curve to becoming productive in. Additionally, it's more focused to the job at hand, as opposed to being a general purpose language.</p><p>At Monzo, we encourage everyone to do data transformation in SQL, and take a good hard look when people are using other programming languages to do it in. We&#8217;d rather trade off absolute power and customisability in return making the 99% use case dramatically better.</p><h3>SQL-centric</h3><p>dbt code is all the SQL your data warehouse supports, plus some extra functionality. You don't feel like you're writing in a custom framework. This aids with onboarding and maintainability.</p><h3>Structured relationships between models</h3><p>A dbt model is a SQL statement. You can build a model from another model by referring to it, using the&nbsp;<code>ref</code>&nbsp;function.</p><p>This is simple, but extremely powerful. dbt now understands&nbsp;<strong>how</strong>&nbsp;your models relate to each other as a graph. Previously, any relationship between models was implicit, and ordering of execution would need to be provided by the programmer.</p><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg" width="1422" height="1114" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1114,&quot;width&quot;:1422,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;Relationships between models&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt="Relationships between models" title="Relationships between models" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F841805a3-d50d-4cef-9dcd-3ef287ffe33f_1422x1114.jpeg 1456w" sizes="100vw" loading="lazy"></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><p>This means that dbt can run them in the correct order and run tests at the correct time. In the above example, dbt will run&nbsp;<code>A</code>. If that completes successfully, it will run&nbsp;<code>B</code>&nbsp;and&nbsp;<code>C</code>&nbsp;in parallel, running&nbsp;<code>D</code>&nbsp;after they have both completed.</p><p>If you want to get more advanced, you can parse this graph and perform structural analysis on it, and so on. Machine readability is powerful!</p><h3>Modularity</h3><p>A nice way to think about dbt models is to think of them as pure functions. They should accept some input data, and satisfy some clear objective without side effects, ideally in a simple manner. Structured relationships, in combination with other features, encourages modularity.</p><p>This modularity means that you can compose extremely complex models out of a set of individually simple models. This aids maintainability, and helps force clarity.</p><h3>De-coupling data location from materialisation</h3><p>Data from a staging environment is often not representative to test against, in the same way that it might be in software engineering. It&#8217;s very helpful to be able to use production data to develop.</p><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg" width="1400" height="1138" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/f84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1138,&quot;width&quot;:1400,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;Materialisation&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt="Materialisation" title="Materialisation" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ff84ce632-bcd1-4d6f-bdbc-5e3891be34b8_1400x1138.jpeg 1456w" sizes="100vw" loading="lazy"></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><p>dbt allows you to de-couple the place that you read data from (or the source) from the place that you write it to, or &#8216;materialise&#8217; the output of the queries you are running. This means that everyone can have their own development dataset to use, that is completely decoupled from the production dataset!</p><h3>Testing is a first-class citizen</h3><p>Testing is a well-known technique in software engineering, but is still uncommon in data analysis and transformation. It&#8217;s a fundamental technique for ensuring correctness.</p><p>dbt allows two forms of testing: data tests, and schema tests. I find it useful to liberally scatter schema tests: it helps highlight when any invariants are broken.</p><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg" width="1456" height="294" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/fb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:294,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;Easy tests&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt="Easy tests" title="Easy tests" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb30659e-b861-483c-9188-9bf8475eb441_1541x311.jpeg 1456w" sizes="100vw" loading="lazy"></picture><div></div></div></a><p>Promoting testing to be a first class citizen helps up the quality bar for models written using dbt.</p><h3>Easy continuous integration</h3><p>To supercharge your tests, run them automatically on every change you submit to your source code repository of choice and don't allow the merging of code that fails tests.</p><p>De-coupling source data and materialisation means that running continuous integration tests becomes trivial. You can create a fresh environment per CI run, run all of your dbt models, run the tests, and delete the environment. To repeat: all of the changes that you made will be written to a completely fresh environment that is decoupled from production.</p><p>This allows you to ensure that your changes haven&#8217;t broken anything, which greatly increases reliability when you run it in production. This has historically been very challenging to do with SQL: you&#8217;d need to parameterise all of the tables that you were creating. dbt makes this a breeze.</p><p>We also use the graph that dbt outputs to enforce various checks on the models themselves. For example, all models must be tagged with a&nbsp;<code>model_type</code>, and that all models of type&nbsp;<code>X</code>&nbsp;must have a&nbsp;<code>run</code>&nbsp;tag with a certain set of values. This enforces consistency in code, and allows downstream tooling to make assumptions about what it will be dealing with.</p><h3>De-coupling business logic from &#8216;plumbing&#8217;</h3><p>By plumbing, I mean all of the mechanics of running the SQL to create something in the real world. dbt allows you to determine&nbsp;<em>how</em>&nbsp;your model is materialised, entirely separately from the SQL that is run. This means that you can switch between the following with ease:</p><ul><li><p><code>ephemeral</code>: models that depend on this model have the model &#8216;folded&#8217; in as a Common Table Expression, or CTE.</p></li><li><p><code>view</code>: the model is created as a view. Models that depend on this model select from this view.</p></li><li><p><code>table</code>: the model is created as a table. Models that depend on this model select from this table.</p></li><li><p><code>incremental</code>: the model is initially created as a table. New rows are inserted. Existing rows are updated. You can exclude performing large amounts of work. Models that depend on this model select from this table.</p></li></ul><p>There are a few benefits to this. First, clarity. The business logic remains clear, and the boring mechanics of how the models are materialised is hidden away. Second, flexibility. If you want to turn a table into an incremental model for performance reasons, that&#8217;s a very simple change which you can experiment with quickly.</p><h3>Adding user-specific behaviour through tags</h3><p>Tags are the unsung superpower in dbt. They are a list of user-provided key/value pairs. You can use tags to imbue meaning on a model, or set of models, that dbt does not natively support.</p><p>For example, we use the&nbsp;<code>run</code>&nbsp;tag at Monzo to delineate when we should run the model. Users tag their models with one of&nbsp;<code>hourly</code>,&nbsp;<code>nightly</code>, or&nbsp;<code>weekly</code>. When it comes to running the models later on, we simply select all models that are tagged with the appropriate run tag, and run them.</p><p>This means that users don&#8217;t have to care about&nbsp;<strong>how</strong>&nbsp;their model runs: it just does. This allows for clear contracts between data engineers and data analysts. Analysts write dbt models, data engineers figure out how to run them.</p><p>Other tags that could be useful to you:</p><ul><li><p><code>importance</code>: some models may be trivial, some may be critical to your business and should go through more rigorous change control. Tagging them as such provides context to people developing against it.</p></li><li><p><code>needs_refactoring</code>: This allows you to perform analysis over your codebase to understand whether code quality is getting better or worse. In combination with&nbsp;<code>importance</code>, it would allow you to tell if business critical models have an unsustainable level of technical debt.</p></li></ul><h3>Get-out hatches</h3><p>A beautiful nuance to dbt is that you can override a lot of the default behaviour with your own changes. Fancy changing how a particular materialisation works?&nbsp;<a href="https://docs.getdbt.com/docs/creating-new-materializations">You can do that!</a></p><p>This allows you a &#8216;get-out&#8217; hatch to be able to tweak and tune it to your liking if the default behaviour doesn&#8217;t suit.</p><h3>Documentation</h3><p>Every dbt model has a SQL file with the code of the model, and a YAML file that describes the fields, and any associated tests. This means that documentation remains close to the model in a structured format, instead of adhoc comments next to the code. dbt ships with a way of rendering these docs, which you can serve to your organisation as a static site.</p><p>A subtle but important benefit is that this documentation is machine readable. This allows you to parse this documentation, and push it out to other tools like Looker: allowing a single place to document a field.</p><h2>What is still challenging?</h2><p>Trade-offs exist everywhere in software engineering. Beware any posts that provide 100% praise or criticism. The world is often grey.</p><p>Now that I've finished my soliloquy, here&#8217;s a few things that are challenging in dbt.</p><h3>Mocking out input data</h3><p>In traditional software engineering, a way of testing whether your code is correct is by providing a set of inputs, and asserting that you get the expected outputs after you put them through a function.</p><p>This form of &#8216;mocking out&#8217; input data in dbt is technically possible, but challenging to do.</p><h3>Working with thousands of models</h3><p>dbt doesn&#8217;t perform well when you have thousands of models in a single project. Compilation times take a while, and remove from the snappy interactive experience that you&#8217;re used to.</p><p>I imagine this is an uncommon problem, exacerbated by the fact that Monzo has thousands of individual events which we build data models from.</p><h2>Summary</h2><p>The combination of the above makes dbt an extremely strong tool. I believe it will become 'the default' in the next few years, if it isn't already there, and the next billion dollar company in the space.</p><p>If you choose not to use dbt, you&#8217;ll probably waste time building a less-fully featured, buggy implementation of it yourself. Give it a serious look.</p><div><hr></div><h1><strong>Best of the internet &#128279;</strong></h1><h4><a href="https://duffel.com/blog/what-happens-when-i-search-for-flights">What happens when I search for flights? - Tim Rogers</a></h4><p>A nice dive into the key concepts behind flight search engines. Please do more of these!</p><h4><a href="https://florian.github.io/reservoir-sampling/">Reservoir sampling - </a><strong><a href="https://florian.github.io/reservoir-sampling/">Florian Hartmann</a></strong></h4><p>Reservoir sampling is a beautiful algorithm to select <em>k</em> random elements from an unbounded stream of elements. This blog post explains it in far greater detail.</p><h4><a href="https://medium.com/@steve.yegge/dear-google-cloud-your-deprecation-policy-is-killing-you-ee7525dc05dc">Dear Google Cloud: Your Deprecation Policy is Killing You - Steve Yegge</a></h4><p>A passionate argument about the power of backwards compatibility. You&#8217;re an infrastructure company &#8212; don&#8217;t break stuff people are using! </p><p>For what it&#8217;s worth, I believe the backwards compatibility promises of Go is a huge contributor to the popularity of the language. Code I wrote 6 years ago compiles just fine.</p><div><hr></div><p>That&#8217;s all from this week&#8217;s High Growth Engineering. If you enjoyed it, I&#8217;d really appreciate it if you could do one of the following:</p><ul><li><p>Share it with a friend that would find it useful.</p></li><li><p>Follow me on Twitter:&nbsp;<a href="https://twitter.com/sjwhitworth">@sjwhitworth</a></p></li><li><p>Subscribe: just hit the button below.</p></li></ul><p class="button-wrapper" data-attrs="{&quot;url&quot;:&quot;https://highgrowthengineering.substack.com/subscribe?&quot;,&quot;text&quot;:&quot;Subscribe now&quot;,&quot;action&quot;:null,&quot;class&quot;:null}" data-component-name="ButtonCreateButton"><a class="button primary" href="https://highgrowthengineering.substack.com/subscribe?"><span>Subscribe now</span></a></p><p>All the best,</p><p>Stephen</p>
        </section>
    </article>
</main>
</body>
</html>
